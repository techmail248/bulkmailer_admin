{% extends 'base.html' %}
{% block content %}
<h3 class="mb-3">Dashboard</h3>
<div class="row g-4">
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">SMTP Settings</h5>
        <form method="POST" action="{{ url_for('settings') }}">
          <div class="mb-2"><input class="form-control" name="smtp_host" placeholder="SMTP Host" value="{{ user.smtp_host or '' }}" required></div>
          <div class="mb-2"><input class="form-control" name="smtp_port" placeholder="SMTP Port" value="{{ user.smtp_port or 587 }}" required></div>
          <div class="mb-2"><input class="form-control" name="smtp_user" placeholder="SMTP Username" value="{{ user.smtp_user or '' }}" required></div>
          <div class="mb-2"><input class="form-control" type="password" name="smtp_pass" placeholder="SMTP Password (leave blank to keep)"></div>
          <div class="mb-2"><input class="form-control" name="from_name" placeholder="From Name" value="{{ user.from_name or '' }}"></div>
          <div class="mb-2"><input class="form-control" name="from_email" placeholder="From Email (optional)" value="{{ user.from_email or '' }}"></div>
          <div class="mb-2"><input class="form-control" name="rate_per_minute" placeholder="Rate per minute" value="{{ user.rate_per_minute or 60 }}" required></div>
          <button class="btn btn-primary">Save</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">New Campaign</h5>
        <form method="POST" enctype="multipart/form-data">
          <div class="mb-2"><input class="form-control" name="name" placeholder="Campaign Name"></div>
          <div class="mb-2"><input class="form-control" name="subject" placeholder="Subject (supports {{'{{name}}'}} etc.)" required></div>
          <div class="mb-2">
            <label class="form-label">HTML Template (upload or paste)</label>
            <input class="form-control" type="file" name="html_file" accept=".html,.htm">
            <textarea class="form-control mt-2" name="html_text" rows="6" placeholder="Paste HTML here (supports merge tags like {{'{{name}}'}})"></textarea>
          </div>
          <div class="mb-2">
            <label class="form-label">Recipients (.xlsx/.xls/.csv) â€” must include a column named <code>email</code>. Any other columns can be used as merge tags (e.g., <code>{{'{{name}}'}}</code>).</label>
            <input class="form-control" type="file" name="recipients" accept=".xlsx,.xls,.csv" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Attachment (optional)</label>
            <input class="form-control" type="file" name="attachment">
          </div>
          <button class="btn btn-success">Send</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h5 class="card-title">Recent Campaigns</h5>
        {% if camps %}
          <ul class="list-group">
            {% for c in camps %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <a href="{{ url_for('campaign_detail', cid=c.id) }}">{{ c.name }}</a>
                <div class="text-muted small">{{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
              </div>
              <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('campaign_detail', cid=c.id) }}">View</a>
            </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted">No campaigns yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
